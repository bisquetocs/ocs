{% extends "franchise/home.html" %}
{% load static %}

{% block extras %}

<div class="clearfix">
  <h3 class="float-left">
    Mi Inventario
  </h3>
  <h3 class="float-right">
  </h3>
</div>
<hr />

<ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
  <li class="nav-item">
    <a class="nav-link active" id="pills-auto-tab" data-toggle="pill" href="#pills-auto" role="tab" aria-controls="pills-auto" aria-selected="true">
      Inventario automático <span data-toggle="help_code" title="Este inventario se actualiza automáticamente basado en los pedidos que realizan a proveedores registrados." class="fa fa-question-circle"></span>
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" id="pills-priv-tab" data-toggle="pill" href="#pills-priv" role="tab" aria-controls="pills-priv" aria-selected="false">
      Inventario privado <span data-toggle="help_code" title="Este es un inventario personal, para tener seguimiento de los productos provenientes de un proveedor no registrado." class="fa fa-question-circle"></span>
    </a>
  </li>
</ul>
<div class="tab-content" id="pills-tabContent">
  <div class="tab-pane fade show active" id="pills-auto" role="tabpanel" aria-labelledby="pills-auto-tab">
    <table class="table table-striped table-bordered display" id="">
      <thead class="thead-dark">
        <tr>
          <th >Cantidad</th>
          <th >Unidad</th>
          <th >Nombre</th>
          <th>Proveedor</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for product in linked_product_list %}
        <tr>
          <td>{{ product.amount }}</td>
          <td>{{ product.id_unidad.abreviacion }}</td>
          <td id="l_product_{{ product.id }}">{{ product.id_product.nombre.capitalize }}</td>
          <td>{{ product.id_product.id_provider.nombre }}</td>
          <td><span  class="fa fa-edit" data-toggle="modal" data-target="#io_Lproducts" onclick="update_linked_product({{ product.id }})" ></span></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <div class="row">
      <div class="col-1">
        <!-- Excel Button -->
        <form action="{% url 'franchise:inventory:create_excel' %}" method='POST'>
          {% csrf_token %}
          <button type="submit" class="btn btn-primary"  data-toggle="excel" title="Descarga un archivo EXCEL de tu inventario"><i class="fa fa-file-excel-o"></i></button>
        </form>
      </div>
      <div class="col-1">
        <!-- Records button -->
        <a  href="{% url 'franchise:inventory:show_linked_inventory_records' %}">
          <button type="button" class="btn btn-primary">
            <span class="fa fa-book"></span>&nbsp;Registro de entradas/salidas
          </button>
        </a>
      </div>

    </div>
  </div>
  <div class="tab-pane fade" id="pills-priv" role="tabpanel" aria-labelledby="pills-priv-tab">
    <table class="table table-striped table-bordered display" id="">
      <thead class="thead-dark">
        <tr>
          <th >Cantidad</th>
          <th >Unidad</th>
          <th >Nombre</th>
          <th >Descripción</th>
          <th >
            <span data-toggle="help_code" title="Registrar Entradas/Salidas" class="fa fa-question-circle"></span>
          </th>
        </tr>
      </thead>
      <tbody>
        {% for product in product_list %}
        <tr>
          <td>{{ product.amount }}</td>
          <td>{{ product.unit }}</td>
          <td id="product_{{ product.id }}">{{ product.name }}</td>
          <td>{{ product.description }}</td>
          <td><span  class="fa fa-edit"  data-toggle="modal" data-target="#io_products" onclick="update_private_product({{ product.id }})" ></span></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <br />
    <div class="row">
        <div class="col-1">
          <!--Register Button -->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#register_modal" title="Agrega un producto que no sea de un proveedor registrado">
            <span class="fa fa-plus"></span>
          </button>
        </div>
        <div class="col-1">
          <!-- Excel Button -->
          <form action="{% url 'franchise:inventory:create_excel' %}" method='POST'>
            {% csrf_token %}
            <button type="submit" class="btn btn-primary"  data-toggle="excel" title="Descarga un archivo EXCEL de tu inventario"><i class="fa fa-file-excel-o"></i></button>
          </form>
        </div>
        <div class="col-1">
          <!--Register Button -->
          <a  href="{% url 'franchise:inventory:show_inventory_records' %}">
            <button type="button" class="btn btn-primary">
              <span class="fa fa-book"></span>&nbsp;Registro de entradas/salidas
            </button>
          </a>
        </div>
    </div>
  </div>

</div>





<!-- Modal in/out linked product -->
<div class="modal fade" id="io_Lproducts" tabindex="-1" role="dialog" aria-labelledby="io_LproductsTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="titleModal">Entradas/Salidas</h3>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form action="{% url 'franchise:inventory:update_linked_product' %}" method="POST">
        {% csrf_token %}
        <div class="modal-body">

          <div class="container">
            <div class="row justify-content-md-center">
              <!-- Product to edit -->
              <h5 id="linked_product_title">Nombre del producto</h5>
            </div>
            <br>
            <div class="row justify-content-md-center">
              <input type="hidden" name="id_product" value="" id="id_l_product_to_change">
              <!-- Switch in/out -->
              <div class="btn-group btn-group-toggle" data-toggle="buttons">
                  <label onclick="change_to_input_text()" class="btn btn-outline-primary active">
                    <input type="radio" name="product_io" id="in" autocomplete="off" value="in" checked> Entrada
                  </label>
                <label onclick="change_to_output_text()" class="btn btn-outline-primary">
                  <input type="radio" name="product_io" id="out" autocomplete="off" value="out"> Salida
                </label>
              </div>
            </div>
            <br>
              <!-- Amount -->
              <label for="product_amount" id="io_text">Cantidad que será ingresada:</label>
              <input type="number" class="form-control" size="14" id="product_amount" name="product_amount"  min="1" required>

            <br>

              <!-- Comments -->
              <span data-toggle="help_code" title="Razon/ Responsable/ Comentario/ etc." class="fa fa-question-circle"></span>&nbsp;&nbsp; <label for="product_comment">Comentarios:</label>

               <textarea class="form-control" id="product_comment" name="product_comment" rows="3" maxlength="255"></textarea>

          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
          <button type="submit" class="btn btn-success">Registrar <b id="buttonSave">entrada</b></button>
        </div>
      </form>
    </div>
  </div>
</div>




<!-- Modal in/out private products -->
<div class="modal fade" id="io_products" tabindex="-1" role="dialog" aria-labelledby="io_productsTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="titleModal">Entradas/Salidas</h3>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <form action="{% url 'franchise:inventory:update_private_product' %}" method="POST">
        {% csrf_token %}
        <div class="modal-body">

          <div class="container">
            <div class="row justify-content-md-center">
              <!-- Product to edit -->
              <h5 id="product_title">Nombre del producto</h5>
            </div>
            <br>
            <div class="row justify-content-md-center">
              <input type="hidden" name="id_product" value="" id="id_product_to_change">
              <!-- Switch in/out -->
              <div class="btn-group btn-group-toggle" data-toggle="buttons">
                  <label onclick="change_to_input_text()" class="btn btn-outline-primary active">
                    <input type="radio" name="product_io" id="in" autocomplete="off" value="in" checked> Entrada
                  </label>
                <label onclick="change_to_output_text()" class="btn btn-outline-primary">
                  <input type="radio" name="product_io" id="out" autocomplete="off" value="out"> Salida
                </label>
              </div>
            </div>
            <br>
              <!-- Amount -->
              <label for="product_amount" id="io_text">Cantidad que será ingresada:</label>
              <input type="number" class="form-control" size="14" id="product_amount" name="product_amount"  min="1" required>

            <br>

              <!-- Comments -->
              <span data-toggle="help_code" title="Razon/ Responsable/ Comentario/ etc." class="fa fa-question-circle"></span>&nbsp;&nbsp; <label for="product_comment">Comentarios:</label>

               <textarea class="form-control" id="product_comment" name="product_comment" rows="3" maxlength="255"></textarea>

          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
          <button type="submit" class="btn btn-success">Registrar <b id="buttonSave">entrada</b></button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal register product-->
<div class="modal fade" id="register_modal" tabindex="-1" role="dialog" aria-labelledby="register_modalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="register_modalLabel">Registrar producto</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <p>
          Agrega un producto que no sea de un provedor registrado
        </p>

        <form method="POST" action="{% url 'franchise:inventory:register_private_product' %}">
        {% csrf_token %}

        <div class="col mb-3">
          <label for="product_name">Nombre</label>
          <input type="text" class="form-control" id="product_name" name="product_name" placeholder="Mermelada de fresa"  required>
        </div>

        <div class="col mb-3">
          <label for="product_desc">Descripción</label>
          <input type="text" class="form-control" id="product_desc" name="product_desc" placeholder="Frasco de 980gr"  required>
        </div>

        <div class="row">
          <div class="col">
            <label for="product_amount">Cantidad</label>
            <input type="number" class="form-control" id="product_amount" name="product_amount" required>
          </div>
          <div class="col">
            <div class="form-group">
              <label for="product_unit">Unidad de medida</label>
              <select class="form-control" id="product_unit" name="product_unit">
                <option value="KG">Kilogramos</option>
                <option value="GR">Gramos</option>
                <option value="PZ">Piezas</option>
                <option value="BUL">Bultos</option>
                <option value="MAN">Manojos</option>
              </select>
            </div>
          </div>
        </div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-primary">Save changes</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript" src="{% static 'js/setModal.js' %}"></script>
<script type="text/javascript" charset="utf8" src="{% static 'js/datatables.js' %}"></script>
<script>
$(document).ready(function(){
    $('[data-toggle="help_code"]').tooltip();
    $('[data-toggle="modal"]').tooltip();
    $('[data-toggle="excel"]').tooltip();
});
</script>
{% endblock extras %}
